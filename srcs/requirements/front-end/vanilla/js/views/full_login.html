<html><head><script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

	<style>
		#loginPopup {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: #fff;
			padding: 20px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
			z-index: 9999;
			max-width: 400px; /* Adjust the maximum width as needed */
			width: 100%;
			border-radius: 8px; /* Add border-radius for rounded corners */
		  }
	  
		#loginPopup h2 {
			color: #333; /* Change the heading text color */
		  }
	  
		#loginPopup input {
			width: 100%;
			padding: 10px;
			margin-bottom: 10px;
			border: 1px solid #ccc;
			border-radius: 4px;
		  }
	  
		#loginPopup input[type="submit"] {
			background-color: #4CAF50;
			color: #fff; 
			cursor: pointer;
		  }
	  
		#loginPopup input[type="submit"]:hover {
			background-color: #45a049;
		  }
	  
		#darkLayer {
			  display: none;
			  position: fixed;
			  top: 0;
			  left: 0;
			  width: 100%;
			  height: 100%;
			  background: rgba(0, 0, 0, 0.3);
			  z-index: 9998;
		  }
	  </style>
	  </head><body><div id="darkLayer"></div>
	
	<h1>Login</h1>
	
	<p></p>
	<button id="devDbButton">DEV-DB</button>
	<p></p>
	
	
	
	<a href="#" id="loginLink">Log in</a>
	
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	
	
	<div id="loginPopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); z-index: 9999; width: 300px;">
	  <span style="float: right; cursor: pointer;" onclick="closeLoginPopup()">×</span>
	  <h2>LOG IN</h2>
	
	  <a>
	  <div id="errorMessage" style="color: red;"></div> <!-- This is where the error message will be displayed -->
	
	  <form id="loginForm" action="" method="POST" onsubmit="submitLoginForm(); return false;">
		<input type="hidden" name="csrfmiddlewaretoken" value="f9voPDsD3hLuGcC1mEqvtbk5w4rbVQ2sskwaEr3aenihelt2PGyq3XS2gI8Svsyy">
		<input name="username" type="text">
		<input name="password" type="password">
		<input type="submit" value="Login">
	  </form>
	
	  </a><a href="#" id="forgotPasswordLink">Forgot Password?</a>
	
	  <div id="oneTimeCodeSection" style="display: none;">
		<input type="hidden" name="csrfmiddlewaretoken" value="f9voPDsD3hLuGcC1mEqvtbk5w4rbVQ2sskwaEr3aenihelt2PGyq3XS2gI8Svsyy">
		<input name="one_time_code" type="text" placeholder="One-Time Code">
		<button onclick="submitOneTimeCode('login')">Submit Code</button>
	  </div>
	
	  <a href="#" id="signupLink">Sign up</a>
	
	  <div id="forgotPasswordModal" style="display: none;">
		<span style="float: right; cursor: pointer;" onclick="closeForgotPasswordModal()">×</span>
	  
		<form id="forgotPasswordForm">
		  <input type="hidden" name="csrfmiddlewaretoken" value="f9voPDsD3hLuGcC1mEqvtbk5w4rbVQ2sskwaEr3aenihelt2PGyq3XS2gI8Svsyy">
		  <input name="username_f" type="text" placeholder="Enter your username" style="width: 200px; margin-right: 5px;">
		  <button type="button" onclick="sendUrlToEmail()">Send Password Reset Link</button>
		</form>
	  </div>
	  <style>
		#signupButton:disabled {
			background-color: grey !important;
			cursor: not-allowed !important;
		}
		#signupButton:enabled {
			background-color: green !important;
			cursor: pointer !important;
		}
		.popup-container {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: #fff;
			padding: 20px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
			z-index: 9999;
			width: 300px;
			max-height: 400px;
			overflow-y: auto;
		}
	</style>
	
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	
	<div id="signupPopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); z-index: 9999; width: 300px;">
		<span style="float: right; cursor: pointer;" onclick="closeSignupPopup()">×</span>
		<h2>Sign Up</h2>
	
		<div id="signupPopupError" style="color: red;"></div> <!-- Add this line -->
	
		<form id="signupForm" action="" method="POST" onsubmit="submitSignupForm(); return false;">
			<input type="hidden" name="csrfmiddlewaretoken" value="f9voPDsD3hLuGcC1mEqvtbk5w4rbVQ2sskwaEr3aenihelt2PGyq3XS2gI8Svsyy">
			<p>ID</p>
			<input name="username" type="text" required="">
			<p>PASSWORD
				<span style="color: green; font-size: smaller;">(minimum 8 characters, at least 1 digit, 1 alphabet, different from email and playername)</span>
			</p>
			<input name="password" type="password">
			<p>CONFIRM PASSWORD</p>
			<input name="confirm_password" id="confirmPassword" type="password" oninput="checkPasswordMatch(); required">
			<div id="confirmPasswordError" style="color: red;"></div>
			<p>PLAYERNAME</p>
			<input name="playername" type="text" required="">
			<p>EMAIL</p>
			<p>
				<label for="signupEmail"></label>
				<input name="signupEmail" id="signupEmail" type="text" placeholder="example@example.com" style="width: 200px; margin-right: 5px;">
				<button type="button" onclick="sendVerificationCode()">Send Code</button>
			</p>
			<p>
				<label for="access_code"></label>
				<input name="access_code" id="verificationCode" type="text" placeholder="######" style="width: 200px; margin-right: 5px;">
				<button type="button" onclick="verifyCode('signup')">Verify Code</button>
				<span id="successMessage" style="color: green; margin-top: 5px;"></span>
			</p>
			<button onclick="openPrivacyPolicyPopup()">Open Privacy Policy</button>
	
			<div id="privacyPolicyPopup" class="popup-container">
				<span style="float: right; cursor: pointer;" onclick="closePrivacyPolicyPopup()">×</span>
			</div> 
			I agree to the terms and conditions.
			<label for="agreementCheckbox">
				<input type="checkbox" id="agreementCheckbox" required="">
			</label><br><br>
			<input type="submit" value="Sign up" id="signupButton" disabled="">
			</form>
		
	
	
	<script>
		$(document).ready(function () {
		updateSignupButtonStatus();
		$("#signupButton").toggleClass("enabled", false);
	
		$("#signupForm input").on("input", function() {
			updateSignupButtonStatus();
		});
	});
		function closeSignupPopup() {
		//   $("#darkLayer").fadeOut();
		  $("#signupPopup").fadeOut();
		  console.log('closeSignupPopup() called\n\n');
		}
		function checkPasswordMatch() {
			var password = $("#signupForm input[name='password']").val();
			var confirmPassword = $("#confirmPassword").val();
	
			if (password !== confirmPassword) {
				$("#confirmPasswordError").text("Passwords do not match");
			} else {
				$("#confirmPasswordError").text("");
			}
		}
		function updateSignupButtonStatus() {
			console.log('updateSignupButtonStatus() called\n\n');
	
			var form = $("#signupForm")[0];
			var allFieldsFilled = Array.from(form.elements).every(function(element) {
				return element.checkValidity();
			});
	
			var password = $("#signupForm input[name='password']").val();
			var confirmPassword = $("#confirmPassword").val();
			var isPasswordMatch = password === confirmPassword;
	
			var isCodeVerified = $("#successMessage").text() === "Verified successfully";
	
			if (allFieldsFilled && isPasswordMatch && isCodeVerified) {
				$("#signupButton").prop("disabled", false);
				// console.log('BUTTON: need to be enable\n\n');
	
			} else {
				$("#signupButton").prop("disabled", true);
			}
			$("#signupButton").toggleClass("enabled", allFieldsFilled && isPasswordMatch && isCodeVerified);
		}
		function getCookie(name) {
			var cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
		return cookieValue;
		}
		function sendVerificationCode() {
			var email = $("#signupEmail").val();
	
			$.ajax({
				url: '/api/user_management/auth/access_code',
				type: 'POST',
				data: { 'email': email },
				headers: { "X-CSRFToken": getCookie('csrftoken') },
				success: function (data) {
					if (data.success) {
						console.log('Code sent successfully');
					} else {
						console.log('Failed to send code:', data.error_message);
					}
				},
				error: function () {
					console.log('An error occurred while processing your request.');
				}
			});
		}
		function openPrivacyPolicyPopup() {
			$.get("/api/user_management/auth/policy", function(data) {
				$("#privacyPolicyPopup").html(data);
				$("#privacyPolicyPopup").fadeIn();
			});
		}
		function closePrivacyPolicyPopup() {
			$("#privacyPolicyPopup").fadeOut();
		}
		window.addEventListener("message", function(event) {
			if (event.data.type === "checkboxStateChange") {
				document.getElementById('agreementCheckbox').checked = event.data.checked;
			}
		}, false);
		function verifyCode(context) {
			var email = $("#signupEmail").val();
			var verificationCode = $("#verificationCode").val();
	
			$.ajax({
				url: '/api/user_management/auth/verify_code',
				type: 'POST',
				data: { 'email': email, 'one_time_code': verificationCode, 'context': context },
				headers: { "X-CSRFToken": getCookie('csrftoken') },
				success: function (data) {
					if (data.success) {
						console.log('Code verified successfully');
						$("#successMessage").text("Verified successfully");
						updateSignupButtonStatus();
						// submitSignupForm();
					} else {
						console.log('Failed to verify code:', data.error_message);
					}
				},
				error: function () {
					console.log('An error occurred while processing your request.');
				}
			});
		}
		function submitSignupForm() {
			$.ajax({
				url: '/api/user_management/auth/signup',
				type: 'POST',
				data: $('#signupForm').serialize(),
				headers: { "X-CSRFToken": getCookie('csrftoken') },
				success: function (data) {
					if (data.success) {
						console.log('signed up success\n\n');
						closeSignupPopup();
					} else {
						$('#signupPopupError').text(data.error_message);
					}
				},
				error: function () {
					// Handle error
					console.log('An error occurred while processing your request.');
				}
			});
		}
	</script>
	
	
	<script>
	  $(document).ready(function () {
		var signupClicked = false;
	
		$("#forgotPasswordLink").click(function () {
		  $("#darkLayer").fadeIn();
		  $("#forgotPasswordModal").fadeIn();
		});
	
		$("#signupLink").click(function (event) {
			event.stopPropagation()
			signupClicked = true;
	
			console.log('close login popup');
			$("#darkLayer").fadeIn();
			console.log('opacity applied');
			$("#signupPopup").fadeIn();
			console.log('fade in signup popup\n\n');
		});
		$("#loginLink").click(function () {
		console.log('log in link clicked');
		if (!signupClicked) {
		  $("#darkLayer").fadeIn();
		  console.log('opacity applied');
		  $("#loginPopup").fadeIn();
		  console.log('fade in login popup\n\n');
		}
		signupClicked = false; // Reset the flag after handling the click
	  });
	});
	
	  function closeForgotPasswordModal() {
		  $("#darkLayer").fadeOut();
		  $("#forgotPasswordModal").fadeOut();
		}
	
	  function closeLoginPopup() {
		  $("#darkLayer").fadeOut();
		  $("#loginPopup").fadeOut();
		  console.log('closeLoginPopup() called\n\n');
		}
	
		function closeSignupPopup() {
		// $("#darkLayer").fadeOut();
		$("#signupPopup").fadeOut();
		console.log('closeSignupPopup() called\n\n');
	  }
	  function submitLoginForm() {
		$.ajax({
		  url: '/api/user_management/auth/login',
		  type: 'POST',
		  data: $('#loginForm').serialize(),
		  headers: { "X-CSRFToken": "f9voPDsD3hLuGcC1mEqvtbk5w4rbVQ2sskwaEr3aenihelt2PGyq3XS2gI8Svsyy" },
		  success: function (data) {
			console.log('Login successful:', data);
			if (data.requires_2fa) {
			// closeLoginPopup();
			// window.location.href = '';
			  $('#loginForm').hide();
			  $("#forgotPasswordLink").hide();
			  $('#signupLink').hide();
			  $('#oneTimeCodeSection').show();
			} else {
			  console.log('2FA not required');
			}
		  },
		  error: function (xhr, textStatus, errorThrown) {
			console.log('An error occurred while processing your request.');
			var response = JSON.parse(xhr.responseText);
			if (response && response.error) {
				displayErrorMessage(response.error);
			} else {
				displayErrorMessage('An error occurred while processing your request.');
			}
		  }  
		});
	  }
	  function getCookie(name) {
		var cookieValue = null;
		if (document.cookie && document.cookie !== '') {
		  var cookies = document.cookie.split(';');
		  for (var i = 0; i < cookies.length; i++) {
			var cookie = cookies[i].trim();
			if (cookie.substring(0, name.length + 1) === (name + '=')) {
			  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
			  break;
			}
		  }
		}
		return cookieValue;
	  }
	  function submitOneTimeCode(context) {
		var oneTimeCode = $('input[name="one_time_code"]').val();
		console.log('submitOneTimeCode submit');
		$.ajax({
		  url: '/api/user_management/auth/verify_code',
		  type: 'POST',
		  data: { 'one_time_code': oneTimeCode, 'context': context },
		  headers: { "X-CSRFToken": getCookie('csrftoken') },
		  success: function (data) {
			console.log('One-time code verification successful:', data);
			closeLoginPopup();
			window.location.href = '';
		  },
		  error: function (xhr, textStatus, errorThrown) {
			console.log('One-time code verification failed.');
			var response;
			try {
			  response = JSON.parse(xhr.responseText);
			} catch (e) {
			  response = { error: 'An error occurred while processing your request.' };
			}
			displayErrorMessage(response.error);
		  },
		  complete: function (xhr, textStatus) {
			console.log('Request complete. Status:', textStatus);
		  }
		});
	  }
	  
	  function sendUrlToEmail() {
		var username = $('input[name="username_f"]').val();
		$.ajax({
		  url: '/api/user_management/auth/sendResetLink',
		  type: 'POST',
		  data: { 'username': username },
		  headers: { "X-CSRFToken": getCookie('csrftoken') },
		  success: function (data) {
			console.log('Password reset link sent successfully:', data);
			closeForgotPasswordModal();
		  },
		  error: function (xhr, textStatus, errorThrown) {
			console.log('Error sending reset Link:', errorThrown);
		  },
		  complete: function (xhr, textStatus) {
			console.log('Request complete. Status:', textStatus);
		  }
		});
		return false;
	  }
	
	  function displayErrorMessage(message) {
		$('#errorMessage').text(message).css('color', 'red');
	}
	
	</script>
	
	
	
	<script>
	  $(document).ready(function () {
		  $('#devDbButton').on('click', function () {
			  $.ajax({
				  type: 'GET',
				  url: '/api/user_management/auth/developer_setting',
				  success: function (data) {
					  console.log('Print all user data successful:', data);
					  window.location.href = '/api/user_management/auth/developer_setting';
				  },
				  error: function (error) {
					  console.error('Error Cannot print user data:', error);
				  }
			  });
		  });
	  });
	</script></div></div></body></html>